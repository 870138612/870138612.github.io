import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as e,o as t}from"./app-DMDusy5Y.js";const l={};function n(h,i){return t(),a("div",null,i[0]||(i[0]=[e(`<h2 id="pci直通" tabindex="-1"><a class="header-anchor" href="#pci直通"><span>PCI直通</span></a></h2><p>一些PCI设备提供独占设备能力和共享能力，在使用SR-IOV时，物理设备会被虚拟化为多个PCI设备，虚拟化设备可以分配给不同的主机，在PCI直通的情况下，完整的物理设备只会分配给一个主机。</p><h3 id="计算节点准备" tabindex="-1"><a class="header-anchor" href="#计算节点准备"><span>计算节点准备</span></a></h3><ul><li><p><strong>硬件要求</strong>：</p><ul><li>BIOS 启用 VT-d（Intel）或 AMD-Vi（AMD）。</li><li>Linux 内核启用 IOMMU：添加<code>intel_iommu=on</code>或<code>amd_iommu=on</code>到内核参数。</li></ul></li><li><p><strong>验证命令</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dmesg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iommu</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 检查 IOMMU 是否启用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lspci</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">               # 查看 PCI 设备信息及地址（如 0000:41:00.0）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="配置-nova-compute" tabindex="-1"><a class="header-anchor" href="#配置-nova-compute"><span>配置 nova-compute</span></a></h3><ul><li><p><strong>指定 PCI 设备</strong>：</p><ul><li><p>按设备地址配置（示例）：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[pci]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">device_spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> { </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;address&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0000:41:00.0&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>按厂商/产品 ID 配置（示例为 Intel X520 网卡）：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[pci]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">device_spec</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> { </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;vendor_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;8086&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;product_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;154d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><strong>定义设备别名</strong>：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[pci]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">alias</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> { </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;vendor_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;8086&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;product_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;154d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;device_type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;type-PF&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>device_type</code>必须指定为<code>type-PF</code>（SR-IOV 父设备）、<code>type-VF</code>（子设备）或<code>type-PCI</code>（非 SR-IOV 设备）。</li></ul></li></ul><h3 id="配置-nova-scheduler" tabindex="-1"><a class="header-anchor" href="#配置-nova-scheduler"><span>配置 nova-scheduler</span></a></h3><ul><li><p>启用 <code>PciPassthroughFilter</code> 过滤器：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[filter_scheduler]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">enabled_filters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> ...,PciPassthroughFilter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="配置nova-api" tabindex="-1"><a class="header-anchor" href="#配置nova-api"><span>配置nova-api</span></a></h3><ul><li><p>控制器节点需同步 <code>pci.alias</code> 配置，与计算节点一致：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[pci]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">alias</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> { </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;vendor_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;8086&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;product_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;154d&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;device_type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;type-PF&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="配置-flavor" tabindex="-1"><a class="header-anchor" href="#配置-flavor"><span><strong>配置 Flavor</strong></span></a></h3><ul><li><p>通过 Flavor 请求 PCI 设备（示例请求 2 个 <code>a1</code> 设备）：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">openstack flavor set m1.large --property </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;pci_passthrough:alias&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a1:2&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h3 id="高级配置" tabindex="-1"><a class="header-anchor" href="#高级配置"><span>高级配置</span></a></h3><h5 id="pci-numa-亲和策略" tabindex="-1"><a class="header-anchor" href="#pci-numa-亲和策略"><span><strong>PCI-NUMA 亲和策略</strong></span></a></h5><ul><li><p><strong>策略选项</strong>：</p><ul><li><code>required</code>：设备必须与实例的 NUMA 节点严格绑定</li><li><code>socket</code>：设备与实例在同一CPU插槽即可</li><li><code>preferred</code>：尽量亲和，但不强制</li><li><code>legacy</code>：默认策略，兼容旧版本行为</li></ul></li><li><p><strong>配置示例</strong>：</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">openstack flavor set $FLAVOR --property hw:</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">pci_numa_affinity_policy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">preferred</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h3 id="验证pci直通" tabindex="-1"><a class="header-anchor" href="#验证pci直通"><span>验证PCI直通</span></a></h3><p><strong>登录实例</strong></p><p>通过SSH或控制台登录实例</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openstack</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> console</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> url</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> VM-with-PCI</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 获取控制台 URL</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>检查PCI设备</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lspci</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 列出所有 PCI 设备</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>预期输出</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">00:04.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Ethernet</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> controller:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Intel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Corporation</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 82599ES</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10-Gigabit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SFI/SFP+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Connection</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (rev </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">01</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="常见问题解决" tabindex="-1"><a class="header-anchor" href="#常见问题解决"><span><strong>常见问题解决</strong></span></a></h3><h4 id="问题-1-实例启动失败" tabindex="-1"><a class="header-anchor" href="#问题-1-实例启动失败"><span><strong>问题 1：实例启动失败</strong></span></a></h4><ul><li><p><strong>原因</strong>：PCI 设备未正确配置或资源不足。</p></li><li><p><strong>解决</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nova-status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> upgrade</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> check</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 检查 Nova 服务状态</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openstack</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hypervisor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stats</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 查看计算节点 PCI 资源池</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="问题-2-设备未出现在实例中" tabindex="-1"><a class="header-anchor" href="#问题-2-设备未出现在实例中"><span><strong>问题 2：设备未出现在实例中</strong></span></a></h4><ul><li><p><strong>原因</strong>：驱动未正确绑定或 IOMMU 未启用。</p></li><li><p><strong>解决</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dmesg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> vfio</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 检查 VFIO 驱动绑定状态</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /proc/cmdline</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # 确认内核参数包含 \`intel_iommu=on\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul>`,28)]))}const d=s(l,[["render",n],["__file","pci_passthrough.html.vue"]]),p=JSON.parse('{"path":"/openstack/nova/pci_passthrough.html","title":"PCI直通","lang":"zh-CN","frontmatter":{"title":"PCI直通","star":true,"icon":"page","category":["设备PCI直通","随记"],"tag":["PCI passthrough"],"description":"PCI直通 一些PCI设备提供独占设备能力和共享能力，在使用SR-IOV时，物理设备会被虚拟化为多个PCI设备，虚拟化设备可以分配给不同的主机，在PCI直通的情况下，完整的物理设备只会分配给一个主机。 计算节点准备 硬件要求： BIOS 启用 VT-d（Intel）或 AMD-Vi（AMD）。 Linux 内核启用 IOMMU：添加intel_iomm...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/openstack/nova/pci_passthrough.html"}],["meta",{"property":"og:site_name","content":"Zzz"}],["meta",{"property":"og:title","content":"PCI直通"}],["meta",{"property":"og:description","content":"PCI直通 一些PCI设备提供独占设备能力和共享能力，在使用SR-IOV时，物理设备会被虚拟化为多个PCI设备，虚拟化设备可以分配给不同的主机，在PCI直通的情况下，完整的物理设备只会分配给一个主机。 计算节点准备 硬件要求： BIOS 启用 VT-d（Intel）或 AMD-Vi（AMD）。 Linux 内核启用 IOMMU：添加intel_iomm..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-16T13:30:32.000Z"}],["meta",{"property":"article:tag","content":"PCI passthrough"}],["meta",{"property":"article:modified_time","content":"2025-03-16T13:30:32.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"PCI直通\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-16T13:30:32.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Zzz\\",\\"url\\":\\"https://ylzhong.top\\"}]}"]]},"headers":[{"level":2,"title":"PCI直通","slug":"pci直通","link":"#pci直通","children":[{"level":3,"title":"计算节点准备","slug":"计算节点准备","link":"#计算节点准备","children":[]},{"level":3,"title":"配置 nova-compute","slug":"配置-nova-compute","link":"#配置-nova-compute","children":[]},{"level":3,"title":"配置 nova-scheduler","slug":"配置-nova-scheduler","link":"#配置-nova-scheduler","children":[]},{"level":3,"title":"配置nova-api","slug":"配置nova-api","link":"#配置nova-api","children":[]},{"level":3,"title":"配置 Flavor","slug":"配置-flavor","link":"#配置-flavor","children":[]},{"level":3,"title":"高级配置","slug":"高级配置","link":"#高级配置","children":[]},{"level":3,"title":"验证PCI直通","slug":"验证pci直通","link":"#验证pci直通","children":[]},{"level":3,"title":"常见问题解决","slug":"常见问题解决","link":"#常见问题解决","children":[]}]}],"git":{"createdTime":1742130587000,"updatedTime":1742131832000,"contributors":[{"name":"zyl","email":"870138612@qq.com","commits":4}]},"readingTime":{"minutes":1.99,"words":598},"filePathRelative":"openstack/nova/pci_passthrough.md","localizedDate":"2025年3月16日","excerpt":"<h2>PCI直通</h2>\\n<p>一些PCI设备提供独占设备能力和共享能力，在使用SR-IOV时，物理设备会被虚拟化为多个PCI设备，虚拟化设备可以分配给不同的主机，在PCI直通的情况下，完整的物理设备只会分配给一个主机。</p>\\n<h3>计算节点准备</h3>\\n<ul>\\n<li>\\n<p><strong>硬件要求</strong>：</p>\\n<ul>\\n<li>BIOS 启用 VT-d（Intel）或 AMD-Vi（AMD）。</li>\\n<li>Linux 内核启用 IOMMU：添加<code>intel_iommu=on</code>或<code>amd_iommu=on</code>到内核参数。</li>\\n</ul>\\n</li>\\n<li>\\n<p><strong>验证命令</strong>：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">dmesg</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\"> | </span><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">grep</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -i</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> iommu</span><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\">  # 检查 IOMMU 是否启用</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">lspci</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -v</span><span style=\\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\\">               # 查看 PCI 设备信息及地址（如 0000:41:00.0）</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div></li>\\n</ul>","autoDesc":true}');export{d as comp,p as data};
